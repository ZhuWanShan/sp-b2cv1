<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mvc="http://www.springframework.org/schema/mvc" 
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:security="http://www.springframework.org/schema/security"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	http://www.springframework.org/schema/context
	http://www.springframework.org/schema/context/spring-context-3.0.xsd
	http://www.springframework.org/schema/mvc
	http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd
	http://www.springframework.org/schema/aop
	http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
	http://www.springframework.org/schema/security 
	http://www.springframework.org/schema/security/spring-security-3.1.xsd">

	<aop:aspectj-autoproxy />
	<context:annotation-config/>
	<mvc:annotation-driven/>
	
	<bean class="com.spshop.web.interceptor.ModelAttributeAndLoginCheckInjecter"></bean>
	
	<mvc:resources location="/css/" mapping="/css/**"/>
	<mvc:resources location="/im/" mapping="/im/**"/>
	<mvc:resources location="/image/" mapping="/image/**"/>
	<mvc:resources location="/js/" mapping="/js/**"/>
	<mvc:resources location="/script/" mapping="/script/**"/>
	<mvc:resources location="/template/" mapping="/template/**"/>
	<mvc:resources location="/style/" mapping="/style/**"/>
	<mvc:resources location="/tempZip/" mapping="/tempZip/**"/>
	<mvc:resources location="/admin/" mapping="/admin/**"/>
	<mvc:resources location="/workspace/" mapping="/workspace/**"/>
	
	<security:http pattern="/css/**" security="none" />
	<security:http pattern="/im/**" security="none" />
	<security:http pattern="/image/**" security="none" />
	<security:http pattern="/js/**" security="none" />
	<security:http pattern="/script/**" security="none" />
	<security:http pattern="/template/**" security="none" />
	<security:http pattern="/style/**" security="none" />
	<security:http pattern="/tempZip/**" security="none" />
	<security:http pattern="/admin/**" security="none" />
	<security:http pattern="/workspace/**" security="none" />
	
	<mvc:default-servlet-handler default-servlet-name="AdminLogin" />
	<mvc:default-servlet-handler default-servlet-name="queryService" />
	<mvc:default-servlet-handler default-servlet-name="initServlet" />
	<mvc:default-servlet-handler default-servlet-name="ImageCreate" />
	<mvc:default-servlet-handler default-servlet-name="ImageBatchCreate" />
	
	<bean id="bootstrapFilter" class="com.spshop.web.interceptor.BootstrapDataFilter"></bean> 
	<bean id="categoryFilter" class="com.spshop.web.interceptor.CategoryDataFilter"></bean> 
	<bean id="productDataFilter" class="com.spshop.web.interceptor.ProductDataFilter"></bean> 
	<bean id="loginUrlRecorderFilter" class="com.spshop.web.interceptor.LoginUrlRecorderFilter"></bean> 
	<bean id="filterChainProxy" class="org.springframework.security.web.FilterChainProxy">
		<security:filter-chain-map request-matcher="ant">
			<security:filter-chain pattern="/c/*" filters="bootstrapFilter, categoryFilter"/>
			<security:filter-chain pattern="/uc/*" filters="bootstrapFilter, loginUrlRecorderFilter"/>
			<security:filter-chain pattern="/*" filters="bootstrapFilter, productDataFilter" />	
			<security:filter-chain pattern="/**" filters="bootstrapFilter"  />
		</security:filter-chain-map>
	</bean>
	
	<context:component-scan base-package="com.spshop.web">
		<context:include-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
	</context:component-scan>
	
	<bean id="viewResolver"
		class="com.spshop.web.view.CustomFreeMarkerViewResolver">
		<property name="suffix" value=".hpl" />
	</bean>
	<bean id="freemarkerConfig"
		class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer">
		<property name="templateLoaderPath" value="/WEB-INF/tpl/" />
		<property name="defaultEncoding" value="UTF-8"></property>
	</bean>


</beans>
